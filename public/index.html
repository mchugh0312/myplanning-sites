<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Loading...</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600&family=Cormorant+Garamond:wght@300;400;500&family=Montserrat:wght@300;400;500&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{
--classic-primary:#2c3e50;--classic-accent:#e8b4b8;
--floral-primary:#d4a574;--floral-accent:#f4e4d7;
--modern-primary:#5a7f7f;--modern-accent:#f5e6d3;
--elegant-primary:#8b7355;--elegant-accent:#fff8f0;
}
html,body{height:100%;overflow-x:hidden}
body{display:flex;flex-direction:column;font-size:15px;line-height:1.6}

/* Navigation - Refined */
.nav-top{position:fixed;top:0;left:0;right:0;z-index:1000;background:rgba(255,255,255,.97);backdrop-filter:blur(8px);box-shadow:0 1px 10px rgba(0,0,0,.05)}
.nav-container{max-width:1100px;margin:0 auto;padding:0 2rem;display:flex;justify-content:space-between;align-items:center;height:65px}
.logo{font-size:1.2rem;font-weight:600;cursor:pointer;letter-spacing:0.5px}
.nav-links{display:flex;gap:1.5rem;list-style:none;font-size:0.85rem;letter-spacing:0.3px}
.nav-link{font-weight:400;padding:.4rem .8rem;cursor:pointer;transition:all .25s;text-transform:uppercase;font-size:0.8rem}
.mobile-toggle{display:none;background:none;border:none;font-size:1.4rem;cursor:pointer}

#app{flex:1;margin-top:65px;overflow-y:auto}

/* Refined Countdown */
.countdown{display:flex;gap:1.5rem;justify-content:center;margin-top:1.5rem;flex-wrap:wrap}
.countdown-item{text-align:center;min-width:70px}
.countdown-number{font-size:2.2rem;font-weight:500;line-height:1;margin-bottom:0.4rem}
.countdown-label{font-size:0.75rem;text-transform:uppercase;letter-spacing:0.8px;opacity:0.85}

/* Loading & Modal */
.loading{display:flex;align-items:center;justify-content:center;min-height:100vh}
.spinner{border:3px solid #f3f3f3;border-top:3px solid #333;border-radius:50%;width:35px;height:35px;animation:spin 1s linear infinite;margin:0 auto 1rem}
@keyframes spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}
.password-modal{position:fixed;inset:0;background:rgba(0,0,0,0.85);display:flex;align-items:center;justify-content:center;z-index:9999}
.password-box{background:#fff;padding:2.5rem;border-radius:14px;max-width:380px;width:90%;box-shadow:0 15px 50px rgba(0,0,0,0.25)}
.password-box h2{margin:0 0 0.8rem;font-size:1.4rem}
.password-box p{margin-bottom:1rem;font-size:0.9rem;opacity:0.8}
.password-box input{width:100%;padding:0.9rem;border:2px solid #ddd;border-radius:8px;font-size:0.95rem;margin:0.8rem 0;transition:border-color .3s}
.password-box input:focus{outline:none;border-color:#000}
.password-box button{width:100%;padding:0.9rem;background:#000;color:#fff;border:none;border-radius:8px;font-size:0.95rem;font-weight:500;cursor:pointer;transition:background .3s}
.password-box button:hover{background:#333}
.password-box button:disabled{opacity:0.5;cursor:not-allowed}
.error-msg{color:#e74c3c;font-size:0.85rem;display:none;margin-top:0.5rem}

/* Refined Cards */
.event-card{background:#fff;border-radius:12px;padding:2rem;box-shadow:0 2px 12px rgba(0,0,0,.04);margin-bottom:1.5rem;transition:transform .25s,box-shadow .25s}
.event-card:hover{transform:translateY(-2px);box-shadow:0 4px 20px rgba(0,0,0,.08)}
.gallery-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:1.2rem}
.gallery-item{aspect-ratio:1;overflow:hidden;border-radius:10px;box-shadow:0 2px 10px rgba(0,0,0,.08);transition:transform .25s}
.gallery-item:hover{transform:scale(1.03)}
.gallery-item img{width:100%;height:100%;object-fit:cover}

/* Refined Form Styles */
.rsvp-container{max-width:680px;margin:0 auto;background:#fff;padding:2rem;border-radius:14px;box-shadow:0 2px 20px rgba(0,0,0,.06)}
.form-row{display:grid;grid-template-columns:1fr 1fr;gap:1rem;margin-bottom:1rem}
.form-group{margin-bottom:1rem}
.form-group.full-width{grid-column:1/-1}
.form-group label{display:block;margin-bottom:.4rem;font-weight:600;font-size:0.8rem;text-transform:uppercase;letter-spacing:0.4px;opacity:0.9}
.form-group input,.form-group select,.form-group textarea{width:100%;padding:0.75rem;border:1.5px solid #e0e0e0;border-radius:8px;font-size:0.9rem;font-family:inherit;transition:border-color .3s}
.form-group input:focus,.form-group select:focus,.form-group textarea:focus{outline:none;border-color:#666}
.form-group textarea{resize:vertical;min-height:65px}
.radio-group{display:grid;grid-template-columns:repeat(3,1fr);gap:0.7rem;margin-top:.4rem}
.radio-option{padding:0.9rem 0.5rem;border:1.5px solid #e0e0e0;border-radius:8px;cursor:pointer;text-align:center;transition:all .25s;font-size:0.85rem}
.radio-option.selected{border-color:#000;background:#f8f8f8}
.radio-icon{font-size:1.6rem;margin-bottom:0.3rem}
.btn-primary{width:100%;padding:1rem;background:#000;color:#fff;border:none;border-radius:8px;font-size:1rem;font-weight:500;cursor:pointer;transition:background .3s;text-transform:uppercase;letter-spacing:0.8px}
.btn-primary:hover{background:#333}

/* Template Styles - Refined */
.template-classic{font-family:'Playfair Display',serif}
.template-classic .logo{color:var(--classic-primary)}
.template-classic .nav-link{color:#555}
.template-classic .nav-link:hover,.template-classic .nav-link.active{color:var(--classic-primary)}
.template-classic .hero-overlay{background:linear-gradient(135deg,rgba(44,62,80,0.65),rgba(232,180,184,0.55))}
.template-classic .section-title{color:var(--classic-primary)}

.template-floral{font-family:'Cormorant Garamond',serif}
.template-floral .logo{color:var(--floral-primary);font-style:italic}
.template-floral .nav-link{color:#666}
.template-floral .nav-link:hover,.template-floral .nav-link.active{color:var(--floral-primary)}
.template-floral .hero-overlay{background:linear-gradient(135deg,rgba(212,165,116,0.7),rgba(244,228,215,0.65))}
.template-floral .section-title{color:var(--floral-primary);font-style:italic}

.template-modern{font-family:'Montserrat',sans-serif}
.template-modern .logo{color:var(--modern-primary);font-weight:500;letter-spacing:1.5px}
.template-modern .nav-link{color:#666;font-weight:300}
.template-modern .nav-link:hover,.template-modern .nav-link.active{color:var(--modern-primary)}
.template-modern .hero-overlay{background:linear-gradient(135deg,rgba(90,127,127,0.75),rgba(245,230,211,0.65))}
.template-modern .section-title{color:var(--modern-primary);font-weight:500}

.template-elegant{font-family:'Cormorant Garamond',serif}
.template-elegant .logo{color:var(--elegant-primary);letter-spacing:2px}
.template-elegant .nav-link{color:#777}
.template-elegant .nav-link:hover,.template-elegant .nav-link.active{color:var(--elegant-primary)}
.template-elegant .hero-overlay{background:linear-gradient(135deg,rgba(139,115,85,0.7),rgba(255,248,240,0.65))}
.template-elegant .section-title{color:var(--elegant-primary)}
.template-elegant body{background:var(--elegant-accent)}

/* Hero - Refined */
.hero-bg{background-size:cover;background-position:center;position:relative;min-height:calc(100vh - 65px);display:flex;align-items:center;justify-content:center}
.hero-overlay{position:absolute;inset:0;z-index:1}
.hero-content{position:relative;z-index:10;text-align:center;padding:2.5rem 2rem;color:#fff;max-width:800px}
.hero-title{font-size:clamp(2.5rem,7vw,4.5rem);margin-bottom:1.2rem;line-height:1.15;font-weight:400;letter-spacing:1.5px}
.hero-subtitle{font-size:1.15rem;margin-bottom:1.5rem;opacity:0.95;letter-spacing:0.5px}
.hero-location{font-size:0.95rem;opacity:0.9;margin-bottom:0.4rem}

.section{padding:3.5rem 2rem;max-width:1100px;margin:0 auto}
.section-title{font-size:clamp(2rem,4vw,2.8rem);text-align:center;margin-bottom:2.5rem;font-weight:400;letter-spacing:1.5px}
.section-bg-light{background:#fafafa}

@media (max-width:768px){
.nav-links{display:none;flex-direction:column;position:absolute;top:65px;left:0;right:0;background:#fff;padding:1.2rem;box-shadow:0 3px 15px rgba(0,0,0,.08)}
.nav-links.open{display:flex}
.mobile-toggle{display:block}
.form-row{grid-template-columns:1fr}
.radio-group{grid-template-columns:1fr}
.countdown{gap:1rem}
.countdown-item{min-width:55px}
.countdown-number{font-size:1.8rem}
.section{padding:2.5rem 1.5rem}
}
</style>
</head>
<body>
<nav class="nav-top" id="nav" style="display:none">
<div class="nav-container">
<span class="logo" id="logo" onclick="navigateTo('home')">Loading...</span>
<ul class="nav-links" id="nav-menu"></ul>
<button class="mobile-toggle" onclick="toggleMobile()">‚ò∞</button>
</div>
</nav>
<div id="app"><div class="loading"><div style="text-align:center"><div class="spinner"></div><p>Loading...</p></div></div></div>

<script>
// API endpoint for celebration website data
const API='https://wedding-recommender.onrender.com';
const path=window.location.pathname.split('/').filter(p=>p);
const slug=path[0]||'test-celebration';
let currentPage=path[1]||'home';
let celebrationData=null;
let rsvpData={attending:null,meal:null};
let countdownInterval=null;

function updateCountdown(celebrationDate){
if(!celebrationDate)return'';
const target=new Date(celebrationDate).getTime();
const now=new Date().getTime();
const diff=target-now;
if(diff<=0)return'<p style="font-size:1.2rem;opacity:0.9">Today is the day! üéâ</p>';
const days=Math.floor(diff/(1000*60*60*24));
const hours=Math.floor((diff%(1000*60*60*24))/(1000*60*60));
const minutes=Math.floor((diff%(1000*60*60))/(1000*60));
const seconds=Math.floor((diff%(1000*60))/1000);
return`<div class="countdown-item"><div class="countdown-number">${days}</div><div class="countdown-label">Days</div></div><div class="countdown-item"><div class="countdown-number">${hours}</div><div class="countdown-label">Hours</div></div><div class="countdown-item"><div class="countdown-number">${minutes}</div><div class="countdown-label">Minutes</div></div><div class="countdown-item"><div class="countdown-number">${seconds}</div><div class="countdown-label">Seconds</div></div>`;
}

function startCountdown(celebrationDate){
if(!celebrationDate)return;
const el=document.getElementById('countdown-timer');
if(!el)return;
const update=()=>{el.innerHTML=updateCountdown(celebrationDate);};
update();
if(countdownInterval)clearInterval(countdownInterval);
countdownInterval=setInterval(update,1000);
}

function toggleMobile(){
const menu=document.getElementById('nav-menu');
menu.classList.toggle('open');
}

function fmt(dateStr){
if(!dateStr)return'';
const d=new Date(dateStr);
return d.toLocaleDateString('en-US',{weekday:'long',year:'numeric',month:'long',day:'numeric'});
}

function renderHome(d){
const location=d.celebration_location||'';
return`<section class="hero-bg" style="background-image:url(${d.hero_image||'https://images.unsplash.com/photo-1519741497674-611481863552?w=1600'})"><div class="hero-overlay"></div><div class="hero-content"><h1 class="hero-title">${d.couple_names||'Celebration'}</h1>${d.celebration_date?`<p class="hero-subtitle">${fmt(d.celebration_date)}</p>`:''}${location?`<p class="hero-location">üìç ${location}</p>`:''}${d.celebration_date?`<div class="countdown" id="countdown-timer"></div>`:''}</div></section>`;
}

function renderStory(d){
if(!d.story||d.story.trim()==='')return'<div class="section"><h2 class="section-title">Our Story</h2><p style="text-align:center;opacity:0.7">Coming soon...</p></div>';
return`<div class="section"><h2 class="section-title">Our Story</h2><div style="max-width:700px;margin:0 auto;line-height:1.8;white-space:pre-wrap">${d.story}</div></div>`;
}

function renderEvents(d){
if(!d.events||d.events.length===0)return'<div class="section section-bg-light"><h2 class="section-title">Events</h2><p style="text-align:center;opacity:0.7">Event details coming soon...</p></div>';
const eventsHtml=d.events.map(e=>`<div class="event-card"><h3 style="font-size:1.5rem;margin-bottom:0.8rem">${e.name}</h3>${e.date?`<p style="margin-bottom:0.5rem"><strong>üìÖ Date:</strong> ${fmt(e.date)}</p>`:''}${e.time?`<p style="margin-bottom:0.5rem"><strong>üïê Time:</strong> ${e.time}</p>`:''}${e.venue?`<p style="margin-bottom:0.5rem"><strong>üìç Venue:</strong> ${e.venue}</p>`:''}${e.address?`<p style="margin-bottom:0.5rem"><strong>Address:</strong> ${e.address}</p>`:''}${e.dress_code?`<p style="margin-bottom:0.5rem"><strong>üëî Dress Code:</strong> ${e.dress_code}</p>`:''}${e.description?`<p style="margin-top:1rem;line-height:1.6;opacity:0.85">${e.description}</p>`:''}</div>`).join('');
return`<div class="section section-bg-light"><h2 class="section-title">Events</h2>${eventsHtml}</div>`;
}

function renderTravel(d){
const travel=d.travel_info||'';
const accommodation=d.accommodation_info||'';
if(!travel&&!accommodation)return'<div class="section"><h2 class="section-title">Travel & Stay</h2><p style="text-align:center;opacity:0.7">Information coming soon...</p></div>';
return`<div class="section"><h2 class="section-title">Travel & Stay</h2><div style="max-width:700px;margin:0 auto">${travel?`<div style="margin-bottom:2rem"><h3 style="font-size:1.3rem;margin-bottom:1rem">Getting There</h3><div style="line-height:1.8;white-space:pre-wrap">${travel}</div></div>`:''}${accommodation?`<div><h3 style="font-size:1.3rem;margin-bottom:1rem">Where to Stay</h3><div style="line-height:1.8;white-space:pre-wrap">${accommodation}</div></div>`:''}</div></div>`;
}

function renderThingsToDo(d){
const things=d.things_to_do||'';
if(!things||things.trim()==='')return'<div class="section section-bg-light"><h2 class="section-title">Things to Do</h2><p style="text-align:center;opacity:0.7">Recommendations coming soon...</p></div>';
return`<div class="section section-bg-light"><h2 class="section-title">Things to Do</h2><div style="max-width:700px;margin:0 auto;line-height:1.8;white-space:pre-wrap">${things}</div></div>`;
}

function renderGallery(d){
if(!d.gallery_images||d.gallery_images.length===0)return'<div class="section"><h2 class="section-title">Gallery</h2><p style="text-align:center;opacity:0.7">Photos coming soon...</p></div>';
const imgs=d.gallery_images.map(img=>img.thumbnail||img.url);
return`<div class="section section-bg-light"><h2 class="section-title">Gallery</h2><div class="gallery-grid">${imgs.map(u=>`<div class="gallery-item"><img src="${u}" alt="Celebration photo" loading="lazy"></div>`).join('')}</div></div>`;
}

function renderRSVP(d){
if(!d.rsvp_enabled)return'<div class="section"><h2 class="section-title">RSVP</h2><p style="text-align:center;opacity:0.7">RSVP is not currently available.</p></div>';
return`<div class="section"><h2 class="section-title">RSVP</h2><div class="rsvp-container"><form onsubmit="event.preventDefault();submitRSVP()">
<div class="form-row">
<div class="form-group"><label>First Name</label><input type="text" id="rsvp-fname" required></div>
<div class="form-group"><label>Last Name</label><input type="text" id="rsvp-lname" required></div>
</div>
<div class="form-group full-width"><label>Email</label><input type="email" id="rsvp-email" required></div>
<div class="form-group full-width"><label>Will you be attending?</label>
<div class="radio-group">
<div class="radio-option ${rsvpData.attending==='yes'?'selected':''}" onclick="selectRSVP('yes')"><div class="radio-icon">‚úì</div><div>Attending</div></div>
<div class="radio-option ${rsvpData.attending==='no'?'selected':''}" onclick="selectRSVP('no')"><div class="radio-icon">‚úó</div><div>Can't Make It</div></div>
<div class="radio-option ${rsvpData.attending==='maybe'?'selected':''}" onclick="selectRSVP('maybe')"><div class="radio-icon">?</div><div>Not Sure</div></div>
</div></div>
<div class="form-row" id="meal-section" style="display:${rsvpData.attending==='yes'?'grid':'none'}">
<div class="form-group"><label>Meal Preference</label><select id="rsvp-meal" onchange="rsvpData.meal=this.value">
<option value="">Select preference</option>
<option value="vegetarian" ${rsvpData.meal==='vegetarian'?'selected':''}>üå± Vegetarian</option>
<option value="non-vegetarian" ${rsvpData.meal==='non-vegetarian'?'selected':''}>üçñ Non-Vegetarian</option>
<option value="vegan" ${rsvpData.meal==='vegan'?'selected':''}>ü•ó Vegan</option>
<option value="gluten-free" ${rsvpData.meal==='gluten-free'?'selected':''}>üåæ Gluten-Free</option>
<option value="kids-meal" ${rsvpData.meal==='kids-meal'?'selected':''}>üë∂ Kids Meal</option>
</select></div>
<div class="form-group"><label>Guest Count</label><input type="number" id="rsvp-guests" min="1" max="10" value="1"></div>
</div>
<div class="form-group full-width" style="display:${rsvpData.attending==='yes'?'block':'none'}" id="notes-section">
<label>Special Requests</label><textarea id="rsvp-notes" placeholder="Dietary restrictions, accessibility needs, etc..." rows="2"></textarea>
</div>
<button class="btn-primary" onclick="submitRSVP()">Submit RSVP</button>
</div></div>`;

const pages={home:renderHome,story:renderStory,events:renderEvents,travel:renderTravel,things_to_do:renderThingsToDo,gallery:renderGallery,rsvp:renderRSVP};

function selectRSVP(choice){
rsvpData.attending=choice;
document.querySelectorAll('.radio-option').forEach(opt=>opt.classList.remove('selected'));
event.currentTarget.classList.add('selected');
const meal=document.getElementById('meal-section');
const notes=document.getElementById('notes-section');
if(choice==='yes'){
meal.style.display='grid';
notes.style.display='block';
}else{
meal.style.display='none';
notes.style.display='none';
}
}

function submitRSVP(){
const fname=document.getElementById('rsvp-fname').value;
const lname=document.getElementById('rsvp-lname').value;
const email=document.getElementById('rsvp-email').value;
if(!fname||!lname||!email||!rsvpData.attending){alert('Please fill in all required fields');return;}
const meal=document.getElementById('rsvp-meal')?document.getElementById('rsvp-meal').value:null;
console.log('RSVP:',{fname,lname,email,attending:rsvpData.attending,meal:meal});
alert('Thank you! Your RSVP has been received.');
}

function navigateTo(page){
currentPage=page;
history.pushState({page},null,page==='home'?`/${slug}`:`/${slug}/${page}`);
renderPage(page);
updateNav(page);
window.scrollTo(0,0);
}

function updateNav(page){
document.querySelectorAll('.nav-link').forEach(link=>{
link.classList.remove('active');
if(link.getAttribute('data-page')===page)link.classList.add('active');
});
}

function renderPage(page){
if(!celebrationData)return;
document.getElementById('app').innerHTML=(pages[page]||pages.home)(celebrationData);
if(page==='home'&&celebrationData.celebration_date)startCountdown(celebrationData.celebration_date);
}

function generateNav(data){
const config=data.menu_config||{};
const items=[{key:'home',label:'Home'},{key:'story',label:'Our Story'},{key:'events',label:'Events'},{key:'travel',label:'Travel'},{key:'things_to_do',label:'Things to Do'},{key:'gallery',label:'Gallery'},{key:'rsvp',label:'RSVP'}];
const menu=document.getElementById('nav-menu');
menu.innerHTML='';
items.forEach(item=>{
if(config[item.key]===true){
const li=document.createElement('li');
const span=document.createElement('span');
span.className='nav-link';
span.textContent=item.label;
span.setAttribute('data-page',item.key);
span.onclick=()=>navigateTo(item.key);
li.appendChild(span);
menu.appendChild(li);
}
});
}

function showPasswordModal(){
document.body.innerHTML=`<div class="password-modal"><div class="password-box"><h2>üîí Password Protected</h2><p>This celebration website is private. Please enter the password to continue.</p><input type="password" id="pwd" placeholder="Enter password"><div class="error-msg" id="error">Incorrect password. Please try again.</div><button id="pwd-btn" onclick="retryWithPassword()">Enter</button></div></div>`;
window.retryWithPassword=async function(){
const pwd=document.getElementById('pwd').value;
const btn=document.getElementById('pwd-btn');
const errorDiv=document.getElementById('error');
if(!pwd){errorDiv.style.display='block';errorDiv.textContent='Please enter a password';return;}
btn.disabled=true;btn.textContent='Checking...';errorDiv.style.display='none';
try{await loadCelebrationData(pwd);}catch(e){errorDiv.style.display='block';btn.disabled=false;btn.textContent='Enter';document.getElementById('pwd').value='';document.getElementById('pwd').focus();}
};
document.getElementById('pwd').onkeypress=function(e){if(e.key==='Enter')retryWithPassword();};
document.getElementById('pwd').focus();
}

async function loadCelebrationData(password){
try{
const url=`${API}/wedding-site/${slug}${password?'?password='+encodeURIComponent(password):''}`;
const res=await fetch(url);
if(!res.ok)throw new Error('Not found');
celebrationData=await res.json();
console.log('‚úÖ Loaded celebration data:',celebrationData);

if(celebrationData.password_required===true){showPasswordModal();throw new Error('Password required');}

const p1=(celebrationData.partner_1||'').trim();
const p2=(celebrationData.partner_2||'').trim();
let initials='Celebration';
if(p1&&p2)initials=`${p1[0].toUpperCase()} & ${p2[0].toUpperCase()}`;
else if(celebrationData.couple_names){
const parts=celebrationData.couple_names.split('&').map(s=>s.trim());
if(parts.length===2&&parts[0]&&parts[1])initials=`${parts[0][0].toUpperCase()} & ${parts[1][0].toUpperCase()}`;
}

if(!document.getElementById('nav')){
document.body.innerHTML=`<nav class="nav-top" id="nav"><div class="nav-container"><span class="logo" id="logo" onclick="navigateTo('home')"></span><ul class="nav-links" id="nav-menu"></ul><button class="mobile-toggle" onclick="toggleMobile()">‚ò∞</button></div></nav><div id="app"></div>`;
}

const template=(celebrationData.template||'classic').toLowerCase();
document.body.className=`template-${template}`;

document.getElementById('logo').textContent=initials;
document.title=celebrationData.couple_names||'Celebration';
generateNav(celebrationData);
document.getElementById('nav').style.display='block';
renderPage(currentPage);
updateNav(currentPage);

}catch(e){
if(e.message==='Password required')throw e;
document.getElementById('app').innerHTML=`<div class="section"><h1 style="color:red;text-align:center">Error: ${e.message}</h1></div>`;
}
}

window.onpopstate=e=>{if(e.state&&e.state.page){currentPage=e.state.page;renderPage(currentPage);updateNav(currentPage);}};
loadCelebrationData();
</script>
</body>
</html>
